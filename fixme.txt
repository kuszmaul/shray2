On odd-numbered cachelines, the mprotect of line 254 fails on an ENOMEM

    ENOMEM Internal kernel structures could not be allocated.

    ENOMEM Addresses  in  the range [addr, addr+len-1] are invalid for the address space of the
           process, or specify one or more pages that are not mapped.  (Before  kernel  2.4.19,
           the error EFAULT was incorrectly produced for these cases.)

    ENOMEM Changing  the protection of a memory region would result in the total number of map‚Äê
           pings with distinct attributes (e.g., read versus read/write  protection)  exceeding
           the  allowed  maximum.   (For example, making the protection of a range PROT_READ in
           the middle of a region currently protected as PROT_READ|PROT_WRITE would  result  in
           three  mappings:  two read/write mappings at each end and a read-only mapping in the
           middle.)

Is the end of the range not mapped? 

roundUp((uintptr_t)mmapAddress, ShrayPagesz) * ShrayPagesz - mmapAddress

should be at most ShrayPagesz larger than mmapAddress right?
